//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  SYSTEM
}

enum CallType {
  AUDIO
  VIDEO
}

enum CallStatus {
  RINGING
  ONGOING
  ENDED
  MISSED
  REJECTED
}

model User {
  id              String                    @id() @default(cuid())
  email           String?                   @unique()
  name            String?
  phone           String                    @unique()
  isPhoneVerified Boolean                   @default(false)
  hashedRt        String?
  about           String                    @default("Hey there! I am using GetUno")
  isOnline        Boolean                   @default(false)
  lastSeenAt      DateTime?
  contacts        Contact[]                 @relation("UserContacts")
  contactOf       Contact[]                 @relation("UserIsContactOf")
  participants    ConversationParticipant[]
  messagesSent    Message[]                 @relation("sender")
  messageReads    MessageRead[]
  MessageDeletes  MessageDelete[]
  callsMade       Call[]                    @relation("CallsMade")
  callsReceived   CallParticipant[]         @relation("CallsReceived")
  createdAt       DateTime                  @default(now())
}

model Contact {
  id        String   @id() @default(cuid())
  owner     User     @relation("UserContacts", fields: [ownerId], references: [id])
  ownerId   String
  friend    User     @relation("UserIsContactOf", fields: [friendId], references: [id])
  friendId  String
  createdAt DateTime @default(now())

  @@unique([ownerId, friendId])
}

model Conversation {
  id           String                    @id() @default(cuid())
  isGroup      Boolean                   @default(false)
  name         String?
  createdAt    DateTime                  @default(now())
  participants ConversationParticipant[]
  messages     Message[]
  calls        Call[]
}

model ConversationParticipant {
  id             String       @id() @default(cuid())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  conversationId String
  user           User         @relation(fields: [userId], references: [id])
  userId         String
  role           String?      @default("member")
  joinedAt       DateTime     @default(now())

  @@unique([conversationId, userId])
}

model Message {
  id             String          @id() @default(cuid())
  conversation   Conversation    @relation(fields: [conversationId], references: [id])
  conversationId String
  sender         User            @relation("sender", fields: [senderId], references: [id])
  senderId       String
  content        String?
  type           MessageType     @default(TEXT)
  meta           Json?
  replyTo        Message?        @relation("MessageReply", fields: [replyToId], references: [id])
  replyToId      String?
  deletedForAll  Boolean         @default(false)
  createdAt      DateTime        @default(now())
  reads          MessageRead[]
  deletions      MessageDelete[]
  replies        Message[]       @relation("MessageReply")
}

model MessageRead {
  id        String   @id() @default(cuid())
  message   Message  @relation(fields: [messageId], references: [id])
  messageId String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  readAt    DateTime @default(now())

  @@unique([messageId, userId])
  @@index([userId])
  @@index([messageId])
}

model MessageDelete {
  id        String   @id() @default(cuid())
  message   Message  @relation(fields: [messageId], references: [id])
  messageId String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  deletedAt DateTime @default(now())

  @@unique([messageId, userId])
}

model Call {
  id             String            @id() @default(cuid())
  conversationId String
  conversation   Conversation      @relation(fields: [conversationId], references: [id])
  callerId       String
  caller         User              @relation("CallsMade", fields: [callerId], references: [id])
  type           CallType
  status         CallStatus        @default(RINGING)
  startedAt      DateTime?
  endedAt        DateTime?
  createdAt      DateTime          @default(now())
  participants   CallParticipant[]
}

model CallParticipant {
  id       String    @id() @default(cuid())
  callId   String
  call     Call      @relation(fields: [callId], references: [id])
  userId   String
  user     User      @relation("CallsReceived", fields: [userId], references: [id])
  joinedAt DateTime?
  leftAt   DateTime?

  @@unique([callId, userId])
}
